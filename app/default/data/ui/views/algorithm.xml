<dashboard script="algorithm.js" stylesheet="algorithm.css" hideEdit="true">
  <label>Algorithm</label>
  <search id="algorithm_search">
    <query>| rest splunk_server=local "services/dltk/algorithm/$name|u$"</query>
    <refresh>3s</refresh>
    <refreshType>delay</refreshType>
  </search>
  <search id="deployments_search">
    <query>
      | rest splunk_server=local "services/dltk/deployments" algorithm="$name$"
    </query>
    <refresh>3s</refresh>
    <refreshType>delay</refreshType>
  </search>
  <row>
    <panel id="params_panel">
      <table>
        <title>Parameters</title>
        <search base="algorithm_search">
          <query>
          | fields param.*
          | rename param.* as *
          | untable _ param value
          | table param value
          </query>
        </search>
        <option name="count">20</option>
        <option name="drilldown">none</option>
        <option name="refresh.display">none</option>
      </table>
      <html>
        <button id="edit-params-button" class="btn">Edit Parameters</button>
        <div id="edit-params-dialog" style="display: none" title="Edit Parameters">
          <div class="body">
            <table class="table table-striped params" style="width: 100%;">
              <tr>
                <th>Parameter</th>
                <th>Value</th>
                <th>Actions</th>
              </tr>
            </table>
          </div>
          <div class="footer">
            <button class="btn btn-primary apply" data-dismiss="modal" style="margin-right: 1em">Apply</button>
            <button class="btn cancel" data-dismiss="modal">Cancel</button>
          </div>
        </div>
      </html>
    </panel>
    <panel id="methods_panel">
      <table id="methods_table">
        <title>Methods</title>
        <search base="algorithm_search">
          <query>
          | fields method.* 
          | rename method.* as * 
          | untable _ key value 
          | rex field=key "^(?&lt;name&gt;[^\.]+)\..*$" 
          | eval command_type=if(match(key,"\.command_type$"),value,null()) 
          | eval actions = name+"|"+command_type
          | table name command_type actions
          </query>
        </search>
        <option name="count">20</option>
        <option name="drilldown">none</option>
        <option name="refresh.display">none</option>
      </table>
      <html>
        <div id="command-type-search"
              class="splunk-manager"
              data-require="splunkjs/mvc/searchmanager"
              data-options='{
                "search": { 
                  "type": "token_safe", 
                  "value": "| `command_types`"
                  }
              }'>
        </div>
        <button id="add-method-button" class="btn">Add Method</button>
        <div id="add-method-dialog" style="display: none;" title="Add Method">
          <div class="body form-horizontal">
            <p>Name:</p>
            <p>
              <div id="add-method-name" 
              class="splunk-view" 
              data-require="splunkjs/mvc/textinputview" 
              data-options="{ &quot;default&quot;: &quot;&quot; }">
              </div>
            </p>
            <p>Command Type:</p>
            <p>
              <div id="add-method-command-type"
                   class="splunk-view"
                   data-require="splunkjs/mvc/dropdownview"
                   data-options='{          
                   "managerid": "command-type-search",                       
                   "labelField": "name",
                   "valueField": "name",
                   "default": "reporting"
                   }'>
              </div>
            </p>
          </div>
          <div class="footer">
            <button class="btn btn-primary add" data-dismiss="modal" style="margin-right: 1em">Add</button>
            <button class="btn" data-dismiss="modal">Cancel</button>
          </div>
        </div>
        <div id="edit-method-dialog" style="display: none;" title="Edit Method">
          <div class="body form-horizontal">
            <p>Command Type:</p>
            <p>
              <div id="edit-method-command-type"
                   class="splunk-view"
                   data-require="splunkjs/mvc/dropdownview"
                   data-options='{          
                   "managerid": "command-type-search",                       
                   "labelField": "name",
                   "valueField": "name",
                   "default": "reporting"
                   }'>
              </div>
            </p>
          </div>
          <div class="footer">
            <button class="btn" data-dismiss="modal">Cancel</button>
            <button class="btn btn-primary edit" data-dismiss="modal" style="margin-right: 1em">Apply</button>
          </div>
        </div>
      </html>
    </panel>
  </row>
  <row>
    <panel>
      <table id="deployments_table">
        <title>Deployments</title>
        <search base="deployments_search">
          <query>
          | eval actions = environment+"|"+editable+"|"+disabled+"|"+status+"|"+editor_url
          | eval status = environment+"|"+status+"|"+status_message+"|"+disabled
          | eval parameters = environment
          | foreach param.* [ eval parameters = mvappend(parameters, "&lt;&lt;MATCHSTR&gt;&gt;=" + '&lt;&lt;FIELD&gt;&gt;') ]
          | table environment status parameters actions
          </query>
        </search>
        <option name="count">20</option>
        <option name="refresh.display">none</option>
        <option name="drilldown">none</option>
      </table>
      <html>
        <button id="deploy-button" class="btn">Add Deployment</button>
        <div id="deploy-dialog" style="display: none;" title="Deploy Algorithm">
          <div class="body form-horizontal">
            <p>Environment:</p>
            <div id="environment-search" class="splunk-manager" data-require="splunkjs/mvc/searchmanager" data-options="{                     &quot;search&quot;: { &quot;type&quot;: &quot;token_safe&quot;, &quot;value&quot;: &quot;| rest splunk_server=local services/dltk/environments&quot; }                  }">
            </div>
            <p>
              <div id="environment" class="splunk-view" data-require="splunkjs/mvc/dropdownview" data-options="{                       &quot;managerid&quot;: &quot;environment-search&quot;,                       &quot;labelField&quot;: &quot;name&quot;,                       &quot;valueField&quot;: &quot;name&quot;                   }">
              </div>
            </p>
          </div>
          <div class="footer">
            <button class="btn" data-dismiss="modal">Cancel</button>
            <button class="btn btn-primary create" data-dismiss="modal" style="margin-right: 1em">Deploy</button>
          </div>
        </div>
      </html>
      <html>
        <div id="edit-deployment-parameters-dialog" style="display: none" title="Deployment Parameters">
          <div class="body">
            <table class="table table-striped params" style="width: 100%;">
              <tr>
                <th>Parameter</th>
                <th>Value</th>
                <th>Actions</th>
              </tr>
            </table>
          </div>
          <div class="footer">
            <button class="btn btn-primary apply" data-dismiss="modal" style="margin-right: 1em">Apply</button>
            <button class="btn cancel" data-dismiss="modal">Cancel</button>
          </div>
        </div>
      </html>
    </panel>
  </row>
</dashboard>